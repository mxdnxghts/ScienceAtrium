@page "/executor-panel"

@inject IMediator Mediator

@attribute [Authorize(Policy = "executor-policy")]

<link rel="stylesheet" type="text/css" href="css/executor-panel.css">


<section id="executor-panel" class="executor-panel">
	<div class="container">
		<div class="executor-panel-sect">
			@foreach (var order in _orders ?? Array.Empty<Order>())
			{
				<div class="block-executor-panel">
					<h1>Заказ № @order.Id.GetHashCode()</h1>
					<p>Заказчик: <span>@order.Customer?.Name</span></p>
					<p class="st">Статус - <span>@OrderHelper.GetTranslatedStatus(order.Status)</span></p>
					<p>Сроки сдачи: <span>@order.OrderDate.ToShortDateString()</span></p>
					<p>Цена: <span>@order.TotalCost ₽</span></p>
					<button>Взять</button>
				</div>
			}
		</div>
	</div>
</section>

@code {
	private IEnumerable<Order> _orders;

	protected override async Task OnInitializedAsync()
	{
		_orders ??= await Mediator.Send(new GetOrderListQuery(o => o.Status == OrderStatus.Pending
			&& o.OrderDate >= DateTime.UtcNow));
	}
}
